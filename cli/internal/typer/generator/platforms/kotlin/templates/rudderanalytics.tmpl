class RudderAnalytics(private val analytics: Analytics) {
    private val json = Json {
        prettyPrint = true
        encodeDefaults = false
    }

    private val context = buildJsonObject {
        put("ruddertyper", buildJsonObject {
        {{- range $key, $value := .EventContext }}
            put("{{ $key }}", {{ $value }})
        {{- end }}
        })
    }
{{ range .RudderAnalyticsMethods }}
    /**
     * {{ .Comment }}
     */
    fun {{ .Name }}({{- range $i, $arg := .MethodArguments -}}{{- if $i }}, {{ end -}}{{- .Name }}: {{ .Type }}{{- if .Nullable }}?{{ end }}{{- if .Default }} = {{ .Default }}{{- end }}{{- end -}}) {
        analytics.{{ .SDKCall.MethodName }}(
        {{- range $i, $arg := .SDKCall.Arguments }}
            {{ .Name }} = {{- if .ShouldSerialize }} json.encodeToJsonElement({{ .Value }}).jsonObject{{- else }} {{ .Value }}{{- end }},
        {{- end }}
            options = RudderOptions(customContext = context)
        )
    }
{{ end -}}
}