{{- if .Comment }}
/** {{ escapeComment .Comment }} */
{{- end }}
@Serializable(with = Rudder{{ .Name }}Serializer::class)
sealed class {{ .Name }} : SealedClassWithJson() {
{{- range $prop := .Properties }}
{{- if $prop.Abstract }}
    {{- if $prop.Comment }}
    /** {{ escapeComment $prop.Comment }} */
    {{- end }}
    @SerialName("{{ escapeString $prop.SerialName }}")
    abstract val {{ $prop.Name }}: {{ $prop.Type }}{{ if $prop.Nullable }}?{{ end }}

{{- end }}
{{- end }}
    abstract override val _jsonElement: JsonElement

{{- range $index, $subclass := .Subclasses }}
{{- if or $index (len $.Properties) }}
{{ end }}
    {{- if $subclass.Comment }}
    /** {{ escapeComment $subclass.Comment }} */
    {{- end }}
    @Serializable
    data class {{ $subclass.Name }}(
    {{- range $propIndex, $prop := $subclass.Properties }}{{- if $propIndex }},
{{ end }}
        {{- if $prop.Comment }}
        /** {{ escapeComment $prop.Comment }} */
        {{- end }}
        @SerialName("{{ escapeString $prop.SerialName }}")
        {{ if $prop.Override }}override {{ end }}val {{ $prop.Name }}: {{ $prop.Type }}{{ if $prop.Nullable }}?{{ end }}{{ if $prop.Default }} = {{ $prop.Default }}{{ end }}
    {{- end }}
    ) : {{ $.Name }}() {
    {{- range $prop := $subclass.BodyProperties }}
        {{- if ne $prop.Name "_jsonElement" }}
        {{- if $prop.Comment }}
        /** {{ escapeComment $prop.Comment }} */
        {{- end }}
        @SerialName("{{ escapeString $prop.SerialName }}")
        {{ if $prop.Override }}override {{ end }}val {{ $prop.Name }}: {{ $prop.Type }}{{ if $prop.Nullable }}?{{ end }}{{ if $prop.Default }} = {{ $prop.Default }}{{ end }}
        {{- end }}
    {{- end }}
{{- $hasJsonElementOverride := false }}
{{- range $prop := $subclass.BodyProperties }}
    {{- if eq $prop.Name "_jsonElement" }}
        {{- $hasJsonElementOverride = true }}
    {{- end }}
{{- end }}
{{- if $hasJsonElementOverride }}
    {{- range $prop := $subclass.BodyProperties }}
        {{- if eq $prop.Name "_jsonElement" }}

        {{ if $prop.Override }}override {{ end }}val {{ $prop.Name }}: {{ $prop.Type }} = {{ $prop.Default }}
        {{- end }}
    {{- end }}
{{- else }}
        override val _jsonElement: JsonElement = buildJsonObject {
        {{- range $subclass.Properties }}
            {{- if .Nullable }}
            {{ .Name }}?.let { put("{{ escapeString .SerialName }}", Json.encodeToJsonElement(it)) }
            {{- else }}
            put("{{ escapeString .SerialName }}", Json.encodeToJsonElement({{ .Name }}))
            {{- end }}
        {{- end }}
        {{- range $subclass.BodyProperties }}
            {{- if ne .Name "_jsonElement" }}
            put("{{ escapeString .SerialName }}", Json.encodeToJsonElement({{ .Name }}))
            {{- end }}
        {{- end }}
        }
{{- end }}
    }
{{- end }}
}

private object Rudder{{ .Name }}Serializer : SealedClassJsonSerializer<{{ .Name }}>()